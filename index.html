<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>ONLINE/OFFLINE</title>
	<meta name="author" content="osoba">
	<meta name="description" content="description here">
	<meta name="keywords" content="keywords,here">
	<link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
	<link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Open+Sans' type='text/css'>
	<link rel='stylesheet' href='./ball-pulse.min.css' type='text/css'>
	<link rel='stylesheet' href='./style.css' type='text/css'>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
	<div id="text" class="hide">DUPA</div>
	<table id="tabela" class="hide">
		<tr>
			<th>
				Host
			</th>
			<th>
				Status
			</th>
		</tr>
	</table>
	
	<script>
		var sites = ["zsbi.pl", "www.zsbi.internetdsl.pl", "cufs.vulcan.net.pl", "uonetplus.vulcan.net.pl", "google.com", "google.pl", "youtube.pl", "youtube.com", "facebook.com", "reddit.com", "wykop.pl", "shinden.pl", "dupa.pl"];
		var i = 0;
		sites.forEach(function(entry) {
			$('#tabela').find('tbody:last').append('<tr><td id="' + 'host' + i + '">' + entry + '</td><td class="status"><div id="status' + i + '"><div class="la-ball-pulse"><div></div><div></div><div></div></div></div></td></tr>');
			i++;
		});
		
		var sprawdzonoIlosc = 0;
		var offlineIlosc = 0;
		function Site (domain, index) {
			this.domain = domain;
			this.index = index;
			Site.prototype.xmlhttp = new XMLHttpRequest();
			this.run = function() {
				this.xmlhttp.onreadystatechange = function() {
					if (this.readyState == 4 && this.status == 200) {
						var resp = this.responseText;
						this.getAllResponseHeaders().split('\r\n').forEach(function(entry) {
							var tokens = entry.split('\u003a\u0020');
							if (tokens.length === 2) {
								if(tokens[0] == "Status-Id") {
									var name = "#" + tokens[1];
									if(resp == "true") {
										$(name).fadeOut(200, function(){
											$(name).html("ONLINE");
											$(name).attr("class", "online");
											$(name).fadeIn(200);
										});
									}
									else {
										$(name).fadeOut(200, function(){
											$(name).html("OFFLINE");
											$(name).attr("class", "offline");
											$(name).fadeIn(200);
										});
										offlineIlosc++;
									}
									sprawdzonoIlosc++;
									
									if(sprawdzonoIlosc == sites.length) {
										if(offlineIlosc == 0) {
											$("#text").html("Bomba, wszystko stoi na baczność.");
										}
										else {
											$("#text").html("Coś umarło :(");
										}
										$("#text").toggleClass("hide");
									}
								}
							}
						});
					}
				}
				this.xmlhttp.open("GET", "http://cookiezcreations.ovh/isup.php?host=" + this.domain, true);
				this.xmlhttp.setRequestHeader("Status-Id", "status" + this.index);
				this.xmlhttp.send();
			}
		}
		
		
		var Sites = [];
		for (y = 0; y < i; y++) { 
			var domena = $("#host" + y).text();
			console.log(domena);
			Sites.push(new Site(domena, y));
			Sites[y].run();
		}
		
		setTimeout(function() {
			$("#tabela").toggleClass("hide");
		}, 10);
		
	</script>
</body>

</html>
